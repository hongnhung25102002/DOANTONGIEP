
@{
    ViewBag.Title = "Đặt phòng";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
@model IEnumerable<QLKS.Models.tblPhieuDatPhong>
<header id="gtco-header" class="gtco-cover gtco-cover-md g-header" role="banner" style="background-image: url(/Content/Home/images/img_bg_1.jpg)" data-stellar-background-ratio="0.5">
    <div class="overlay"></div>
</header>
<br />
<br />
<br />
<br />
<div class="container">
    <div class="row">
        <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Phiếu đặt phòng</h3>
                </div>
                <div class="panel-body">
                    @using (Html.BeginForm("Result", "Home"))
                    {
                        @Html.AntiForgeryToken()
                        if (ViewBag.ma_phong == null || ((String)ViewBag.ma_phong).Equals("[]"))
                        {
                            <div class="alert alert-warning" role="alert">Bạn chưa chọn phòng để đặt. Vui lòng chọn phòng để hoàn tất phiếu đặt phòng !</div>
                        }
                        else
                        {
                <div class="form-horizontal">
                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                    <div class="form-group hidden">
                        @Html.Label("Username", htmlAttributes: new { @class = "control-label col-md-2" })
                        <div class="col-md-10">
                            @Html.TextBox("ma_kh", (String)ViewBag.ma_kh, new { @class = "form-control", @readonly = "readonly" })
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.Label("Họ tên", htmlAttributes: new { @class = "control-label col-md-3" })
                        <div class="col-md-9">
                            @Html.TextBox("ten_kh", (String)ViewBag.ten_kh, new { @class = "form-control", @readonly = "readonly" })
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.Label("Ngày đặt", htmlAttributes: new { @class = "control-label col-md-3" })
                        <div class="col-md-9">
                            @Html.TextBox("ngay_dat", (DateTime)ViewBag.ngay_dat, new { @class = "form-control", @readonly = "readonly" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.Label("Ngày vào", htmlAttributes: new { @class = "control-label col-md-3" })
                        <div class="col-md-9">
                            @Html.TextBox("ngay_vao", (String)ViewBag.ngay_vao, new { @class = "form-control", @readonly = "readonly" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.Label("Ngày ra", htmlAttributes: new { @class = "control-label col-md-3" })
                        <div class="col-md-9">
                            @Html.TextBox("ngay_ra", (String)ViewBag.ngay_ra, new { @class = "form-control", @readonly = "readonly" })
                        </div>
                    </div>

                    <div class="form-group hidden">
                        @Html.Label("Mã phòng", htmlAttributes: new { @class = "control-label col-md-3" })
                        <div class="col-md-9">
                            @Html.TextBox("ma_phong", (String)ViewBag.ma_phong, new { @class = "form-control", @readonly = "readonly" })
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.Label("Số phòng", htmlAttributes: new { @class = "control-label col-md-3" })
                        <div class="col-md-9">
                            @Html.TextBox("ten_phong", (String)ViewBag.so_phong, new { @class = "form-control", @readonly = "readonly" })
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.Label("Tổng tiền", htmlAttributes: new { @class = "control-label col-md-3" })
                        <div class="col-md-9">
                            @Html.TextBox("tong_tien", (String)ViewBag.tong_tien, new { @class = "form-control", @readonly = "readonly" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.Label("Tiện ích", htmlAttributes: new { @class = "control-label col-md-3" })
                        <div class="col-md-9">

                            <input type="checkbox" name="checkbox" id="gym" value="1">
                            <label for="gym">Gym</label>

                            <input type="checkbox" name="checkbox" id="xe_dep" value="2">
                            <label for="xe_dep">Xe đạp</label>

                            <input type="checkbox" name="checkbox" id="wifi" value="3">
                            <label for="wifi">Wifi</label>

                            <input type="checkbox" name="checkbox" id="khan-tam" value="4">
                            <label for="khan-tam">khăn tắm</label>

                            <input type="checkbox" name="checkbox" id="phong-xong-hoi" value="5">
                            <label for="phong-xong-hoi">Phòng xông hơi</label>

                            <input type="checkbox" name="checkbox" id="khu-vui-choi" value="6">
                            <label for="khu-vui-choi">Khu vui chơi trẻ em</label>

                            @*@Html.TextBox("ten_phong", (String)ViewBag.so_phong, new { @class = "form-control", @readonly = "readonly" })*@
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.Label("Thanh Toán", htmlAttributes: new { @class = "control-label col-md-3" })
                        <div class="box-custom" style="display:inline-block">
                            <div class="">
                                @Html.TextBox("payment_type", 1, new { @readonly = "readonly", @id = "payment_type_1", @class = "payment_type_class", @type = "radio", @required = "required", @checked = "true" })
                                @Html.Label("Chuyển khoản", htmlAttributes: new { @class = "control-label", @for = "payment_type_1" })
                            </div>
                            <div class="">
                                @Html.TextBox("payment_type", 2, new { @readonly = "readonly", @id = "payment_type_2", @class = "payment_type_class", @type = "radio", @required = "required" })
                                @Html.Label("Thanh toán trực tiếp", htmlAttributes: new { @class = "control-label", @for = "payment_type_2" })
                            </div>
                        </div>
                    </div>
                    <div class="form-group box-the-ngan-hang">
                        @Html.Label("Ngân Hàng", htmlAttributes: new { @class = "control-label col-md-3" })
                        <div class="col-md-12">
                            <div class="vietcombank" style="float: left; margin: 0px 10px; ">
                                <img src="~/hinh-anh/vietcombank.jpg" style="width: 150px; height: 150px;" />
                            </div>
                            <div class="vietcombank" style="float: left; margin: 0px 10px; ">
                                <img src="~/hinh-anh/mbbank.png" style="width: 150px; height: 150px;" />
                            </div>
                            <div class="vietcombank" style="float: left; margin: 0px 10px; ">
                                <img src="~/hinh-anh/momo.jpg" style="width: 150px; height: 150px;" />
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.Label("Đơn vị tính", htmlAttributes: new { @class = "control-label col-md-3" })
                        <div class="box-custom" style="display:inline-block">
                            <div class="">
                                @Html.TextBox("don_vi_tinh", "USD", new { @readonly = "readonly", @id = "don_vi_tinh_usd", @type = "radio", @required = "required", @checked = "true" })
                                @Html.Label("USD", htmlAttributes: new { @class = "control-label", @for = "don_vi_tinh_usd" })
                            </div>
                            <div class="">
                                @Html.TextBox("don_vi_tinh", "VND", new { @readonly = "readonly", @id = "don_vi_tinh_vnd", @type = "radio", @required = "required" })
                                @Html.Label("VND", htmlAttributes: new { @class = "control-label", @for = "don_vi_tinh_vnd" })
                            </div>

                        </div>
                    </div>
                    <div class="form-group">
                        @Html.Label("Tiền Cọc", htmlAttributes: new { @class = "control-label col-md-3" })
                        <div class="col-md-9">
                            <label style="font-size: 15px;color:red" class="txt-note">Vui lòng thanh toán 50% hoặc 100%</label>
                            @Html.TextBox("total_payment", null, new { @class = "form-control", @type = "number", @required = "required" })
                        </div>
                    </div>

                    <div class="form-group">
                        <div class="col-md-offset-2 col-md-9">
                            <input type="submit" value="Đặt phòng" class="btn btn-success" />
                            <a href="@Url.Action("HuyPhieudatPhong", "Home")"><span class="btn btn-default">Hủy</span></a>
                        </div>
                    </div>
                </div>
                        }
                    }

                    <div>
                        @Html.ActionLink("Back to Home", "Index")
                    </div>
                </div>
            </div>

        </div> <div class="col-md-6">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <h3 class="panel-title">Phòng đã đặt</h3>
                </div>
                <div class="panel-body">
                    <table class="table table-striped table-hover" id="dataTable" cellspacing="0">
                        <thead>
                            <tr>
                                <th>
                                    @Html.DisplayName("Tên KH")
                                </th>
                                <th>
                                    @Html.DisplayName("Ngày đặt")
                                </th>
                                <th>
                                    @Html.DisplayName("Ngày vào")
                                </th>
                                <th>
                                    @Html.DisplayName("Ngày ra")
                                </th>
                                <th>
                                    @Html.DisplayName("Số phòng")
                                </th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>

                            @foreach (var item in Model)
                            {

                                <tr>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.tblKhachHang.ho_ten)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.ngay_dat)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.ngay_vao)
                                    </td>
                                    <td>
                                        @Html.DisplayFor(modelItem => item.ngay_ra)
                                    </td>

                                    <td>
                                        @Html.DisplayFor(modelItem => item.tblPhong.so_phong)
                                    </td>
                                    <td>
                                        @*<a class="nav-link" href="@Url.Action("XoaPhieuDatPhong", "Account", new { id = item.ma_pdp })">Hủy</a>*@
                                        <a class="nav-link btn-cancel-room" data-id="@item.ma_pdp" href="javascript:void(0)">Hủy</a>
                                        @*<button type="button" value="@item.ma_pdp" class="">Launch modal</button>*@
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div id="PaymentModal" class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" style=" font-size: 20px;">Vui Lòng thanh toán trước khi đặt phòng?</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" style=" margin: 0px; position: absolute; top: 10px; right: 20px; font-size: 31px;">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p style=" font-size: 17px; margin: 0px;">Bạn sẽ phải chịu 100% phí đã thanh toán.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary btn-dong-y" style="margin: 0px !important; border: 1px solid #FBB448 !important; ">Đồng ý</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
            </div>
        </div>
    </div>
</div>



<!-- Modal -->
<div id="myModal" class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" style=" font-size: 20px;">Bạn có chăc muốn hủy đặt phòng?</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" style=" margin: 0px; position: absolute; top: 10px; right: 20px; font-size: 31px;">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <p style=" font-size: 17px; margin: 0px;">Bạn sẽ phải chịu 100% phí đã thanh toán.</p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary btn-dong-y" style="margin: 0px !important; border: 1px solid #FBB448 !important; ">Đồng ý</button>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Hủy</button>
            </div>
        </div>
    </div>
</div>

<!-- Modal -->
<div id="myModalNotify" class="modal fade" id="exampleModalCenter" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" style=" font-size: 20px;">Bạn đã hủy phòng thành công</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close" style=" margin: 0px; position: absolute; top: 10px; right: 20px; font-size: 31px;">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-footer">
                <a href="/Home/BookRoom" class="btn btn-primary" style="margin: 0px !important; border: 1px solid #FBB448 !important; ">OK</a>
            </div>
        </div>
    </div>
</div>


<script>
    $(document).ready(function () {
        var idPhong = 0;
        $(".btn-cancel-room").click(function () {
            var dataId = $(this).attr("data-id");
            if (dataId > 0) {
                idPhong = dataId;
                $("#myModal").modal('show');
            }
        })
        $(".btn-dong-y").click(function () {
            if (idPhong > 0) {
                CancelBook(idPhong);
            }
        })
        $('input[type=radio][name=payment_type]').change(function () {
            if (this.value == '1') {
                $(".box-the-ngan-hang").show();
                $(".txt-note").text("Vui lòng thanh toán 50% hoặc 100%");
            }
            else if (this.value == '2') {
                $(".txt-note").text("Vui lòng thanh toán 50%");
                $(".box-the-ngan-hang").hide();
            }
        });
    });
    function CancelBook(id) {
        $.ajax({
            url: '/Account/XoaPhieuDatPhongUp',
            type: 'GET',
            dataType: 'json',
            data: {
                id: id
            },
            beforeSend: function () {
                //Loading('show');
            },
            complete: function () {
                ////Loading('hiden');
            },
            success: function (response) {
                $("#myModal").modal('hide');
                console.log(response);
                if (response == 3) {
                    $("#myModalNotify").modal('show');
                }
            }
        })
    }
</script>